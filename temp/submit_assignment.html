<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Assignment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <style>
        :root {
            --primary: #4e73df;
            --secondary: #6f42c1;
            --success: #1cc88a;
            --info: #36b9cc;
            --warning: #f6c23e;
            --danger: #e74a3b;
            --light: #f8f9fc;
            --dark: #5a5c69;
        }
        
        body {
            background-color: #f8f9fc;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
            margin-bottom: 1.5rem;
            border: none;
        }
        
        .card-header {
            background: linear-gradient(180deg, white 0%, #f8f9fc 100%);
            border-bottom: 1px solid #e3e6f0;
            font-weight: 600;
        }
        
        .code-editor {
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e3e6f0;
        }
        
        .editor-header {
            background-color: #eaecf4;
            padding: 8px 15px;
            font-family: monospace;
            font-weight: 600;
            border-bottom: 1px solid #e3e6f0;
        }
        
        textarea.code-area {
            width: 100%;
            min-height: 300px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            padding: 15px;
            border: none;
            line-height: 1.5;
            resize: vertical;
        }
        
        .btn-action {
            min-width: 120px;
        }
        
        .output-container {
            background-color: #f8f9fc;
            border-radius: 8px;
            border: 1px solid #e3e6f0;
        }
        
        .output-header {
            background-color: #eaecf4;
            padding: 8px 15px;
            font-weight: 600;
            border-bottom: 1px solid #e3e6f0;
            border-radius: 8px 8px 0 0;
        }
        
        .output-content {
            padding: 15px;
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success-output {
            border-left: 4px solid var(--success);
        }
        
        .error-output {
            border-left: 4px solid var(--danger);
        }
        
        .message-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            animation: fadeIn 0.5s, fadeOut 0.5s 2.5s forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        .assignment-info {
            background-color: #f0f8ff;
            border-radius: 8px;
            padding: 20px;
        }
        
        .language-badge {
            font-size: 0.75rem;
            padding: 0.35em 0.65em;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-graduation-cap me-2"></i>CodingClass
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'student_dashboard' %}">
                            <i class="fas fa-tachometer-alt me-1"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-user me-1"></i> {{ request.user.username }}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'logout' %}">
                            <i class="fas fa-sign-out-alt me-1"></i> Logout
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row mb-4">
            <div class="col-12">
                <a href="{% url 'student_dashboard' %}" class="btn btn-outline-primary mb-3">
                    <i class="fas fa-arrow-left me-1"></i> Back to Dashboard
                </a>
                
                <div class="card">
                    <div class="card-header py-3">
                        <h5 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-code me-2"></i>Submit Assignment
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Assignment Info -->
                        <div class="assignment-info mb-4">
                            <h3 class="h4">{{ assignment.title }}</h3>
                            <p class="mb-2">{{ assignment.description }}</p>
                            <div class="d-flex align-items-center">
                                <span class="badge bg-primary language-badge me-2">{{ assignment.language }}</span>
                                <small class="text-muted">Make sure your code follows the requirements</small>
                            </div>
                        </div>

                        <!-- Code Submission Form -->
                        <form method="post">
                            {% csrf_token %}
                            
                            <div class="mb-3">
                                <label for="codeEditor" class="form-label fw-bold">Your Code:</label>
                                <div class="code-editor">
                                    <div class="editor-header">
                                        <i class="fas fa-code me-1"></i>{{ assignment.language }}
                                         <i style="color: red;">(only for java program include Main Class)</i>
                                    </div>
                                    <textarea 
                                        id="codeEditor" 
                                        name="code" 
                                        class="code-area" 
                                        placeholder="Write your code here..." 
                                        required
                                    >{{ request.POST.code }}</textarea>
                                </div>
                            </div>
                            
                            <div class="d-flex gap-2">
                                <!-- Run button (just shows output, no save) -->
                                <button type="submit" name="action" value="run" class="btn btn-action btn-outline-primary">
                                    <i class="fas fa-play-circle me-1"></i> Run Code
                                </button>
                                
                                <!-- Submit button (saves submission + output) -->
                                <button type="submit" name="action" value="submit" class="btn btn-action btn-primary">
                                    <i class="fas fa-paper-plane me-1"></i> Submit Assignment
                                </button>
                            </div>
                        </form>

                        <!-- Execution Results -->
                        {% if stdout or stderr %}
                        <div class="output-container mt-4 {% if stderr %}error-output{% else %}success-output{% endif %}">
                            <div class="output-header">
                                <i class="fas fa-terminal me-1"></i> Execution Result
                            </div>
                            <div class="output-content">
                                {% if stdout %}
                                    <h6 class="fw-bold text-success">Output:</h6>
                                    <pre class="bg-light p-3 rounded">{{ stdout }}</pre>
                                {% endif %}
                                
                                {% if stderr %}
                                    <h6 class="fw-bold text-danger">Errors:</h6>
                                    <pre class="bg-light p-3 rounded text-danger">{{ stderr }}</pre>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Messages/Alerts -->
    {% for message in messages %}
    <div class="message-alert alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        <strong>{{ message }}</strong>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
        // Auto-dismiss alerts after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            // Apply syntax highlighting if needed
            document.querySelectorAll('pre code').forEach((el) => {
                hljs.highlightElement(el);
            });
            
            // Auto-dismiss alerts
            setTimeout(function() {
                var alerts = document.querySelectorAll('.message-alert');
                alerts.forEach(function(alert) {
                    var bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                });
            }, 5000);
            
            // Add basic editor functionality
            const codeArea = document.getElementById('codeEditor');
            if (codeArea) {
                // Auto-resize to content
                codeArea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });
                
                // Set initial height
                if (codeArea.value) {
                    codeArea.style.height = 'auto';
                    codeArea.style.height = (codeArea.scrollHeight) + 'px';
                }
            }
        });
    </script>
</body>
</html>